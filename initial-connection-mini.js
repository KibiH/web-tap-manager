function BitArray(e,t){if(this.m_bits=new Array,t&&t.length)for(var o=0;o<t.length;o++)this.m_bits.push(t[o]?BitArray._ON:BitArray._OFF);else isNaN(t)||(this.m_bits=BitArray.shred(t).m_bits);if(e&&this.m_bits.length!=e)if(this.m_bits/length<e)for(o=this.m_bits.length;o<e;o++)this.m_bits.push(BitArray._OFF);else for(o=e;1>this.m_bits.length;o--)this.m_bits.pop();return this.m_bits}function saveSettings(){for(var e=new Uint8Array(20),t=0;t<20;t++)e[t]=0;var o=0;o+=leftHanded,o+=2*!vibration,o+=4*mouseOnly,o+=8*voiceOver,o+=16*autoCorrection,o+=32*scrollDirectionFlip,o+=64*keyboardOnly,o+=128*standbyModeEnabled,e[0]=o;var n=0;n+=mouseSensitivity,n+=16*scrollSensitivity,e[1]=n;var i=0;i+=doubleTapTimeout,i+=16*!airMouse,i+=32*!airMouseMedia,i+=64*!airMouseTv,e[2]=i;var l=0;l+=sleepAfterValue,l+=64*developerMode,e[3]=l,savedSettingsCharacteristic.writeValueWithResponse(e).then((e=>{})).catch((e=>{console.log("Argh! Cant send!!! "+e.message),console.log("it is all over now")}))}function disconnected(){title.innerHTML="Welcome to TapManager Web",searchBtn.style.display="block",tapName.style.display="none",notFoundTxt.style.display="block",generalHeader.style.display="none",leftHandBox.style.display="none",vibrationBox.style.display="none",standbyBox.style.display="none",doubleTapTimeoutBox.style.display="none",sleepAfterBox.style.display="none",textHeader.style.display="none",autoCorrectionBox.style.display="none",inputHeader.style.display="none",mouseOnlyBox.style.display="none",keyboardOnlyBox.style.display="none",mouseAndKeyboardBox.style.display="none",mouseHeader.style.display="none",mouseSensitivityBox.style.display="none",scrollSensitivityBox.style.display="none",scrollDirectionFlipBox.style.display="none",airGesturesHeader.style.display="none",airMouseBox.style.display="none",mediaControlBox.style.display="none",smartTVControlBox.style.display="none",developmentHeader.style.display="none",developerModeBox.style.display="none"}BitArray._ON=1,BitArray._OFF=0,BitArray.shredWithSize=function(e,t){var o=new Array,n=e;do{o.push(n%2),n=Math.floor(n/2)}while(n>0);for(;o.length<t;)o.push(0);return new BitArray(o.length,o)};let DEVICE_INFORMATION="0000180a-0000-1000-8000-00805f9b34fb",BATTERY_SERVICE="0000180f-0000-1000-8000-00805f9b34fb",TAP_SERVICE="c3ff0001-1d8b-40fd-a56f-c7bd5d0f3370",FIRMWARE_REVISION_STRING="00002a26-0000-1000-8000-00805f9b34fb",HARDWARE_REVISION_STRING="00002a27-0000-1000-8000-00805f9b34fb",BATTERY_LEVEL="00002a19-0000-1000-8000-00805f9b34fb",SETTINGS="c3ff0002-1d8b-40fd-a56f-c7bd5d0f3370";function formatToLength2(e){return("0"+e).slice(-2)}function semVerToInt(e){const t=e.split(".");var o="",n="",i="";switch(t.length){case 1:o=formatToLength2(t[0]),n="00",i="00";break;case 2:o=formatToLength2(t[0]),n=formatToLength2(t[1]),i="00";break;case 3:o=formatToLength2(t[0]),n=formatToLength2(t[1]),i=formatToLength2(t[2]);break;default:o="00",n="00",i="00"}return parseInt(o+n+i)}window.addEventListener("error",(function(e){ChromeSamples&&ChromeSamples.setStatus&&(console.error(e),ChromeSamples.setStatus(e.message+" (Your browser may not support this feature.)"),e.preventDefault())}));var deviceName,hardwareVer=0,firmwareVer=0,supportsAirMouse=!1,leftHanded=!1,vibration=!0,standbyModeEnabled=!1,doubleTapTimeout=5,airMouse=!1,airMouseMedia=!1,airMouseTv=!1,sleepAfterValue=2,autoCorrection=!1,mouseOnly=!1,voiceOver=!1,keyboardOnly=!1,mouseAndKeyboard=!0,mouseSensitivity=5,scrollSensitivity=5,scrollDirectionFlip=!1,developerMode=!1,title=document.getElementById("title"),tapName=document.getElementById("tapName");tapName.style.display="none";var notFoundTxt=document.getElementById("notFound");notFoundTxt.style.display="none";var generalHeader=document.getElementById("general");generalHeader.style.display="none";var checkUpdatesBox=document.getElementById("checkForUpdates");checkUpdatesBox.style.display="none";var leftHandBox=document.getElementById("leftHandedBox");leftHandBox.style.display="none";var leftHandedSwitch=document.getElementById("leftHandedSwitch"),vibrationBox=document.getElementById("vibrationBox");vibrationBox.style.display="none";var vibrationSwitch=document.getElementById("vibrationSwitch"),standbyBox=document.getElementById("standbyModeBox");standbyBox.style.display="none";var standbySwitch=document.getElementById("standbyEnabledSwitch"),doubleTapTimeoutBox=document.getElementById("doubleTapTimeoutBox");doubleTapTimeoutBox.style.display="none";var doubleTapSlider=document.getElementById("doubleTapTimeoutSlider"),sleepAfterBox=document.getElementById("sleepAfterBox");sleepAfterBox.style.display="none";var sleepSelector=document.getElementById("sleepSelector"),textHeader=document.getElementById("text");textHeader.style.display="none";var autoCorrectionBox=document.getElementById("autoCorrectionBox");autoCorrectionBox.style.display="none";var autoCorrectionSwitch=document.getElementById("autoCorrectionSwitch"),inputHeader=document.getElementById("input");inputHeader.style.display="none";var mouseOnlyBox=document.getElementById("mouseOnlyBox");mouseOnlyBox.style.display="none";var mouseOnlySwitch=document.getElementById("mouseOnlySwitch"),keyboardOnlyBox=document.getElementById("keyboardOnlyBox");keyboardOnlyBox.style.display="none";var keyboardOnlySwitch=document.getElementById("keyboardOnlySwitch"),mouseAndKeyboardBox=document.getElementById("mouseAndKeyboardBox");mouseAndKeyboardBox.style.display="none";var mouseAndKeyboardSwitch=document.getElementById("mouseAndKeyboardSwitch"),customMappingHeader=document.getElementById("customMapping");customMappingHeader.style.display="none";var tapMappingBox=document.getElementById("tapMappingBox");tapMappingBox.style.display="none";var mappingButton=document.getElementById("mappingButton"),mouseHeader=document.getElementById("mouse");mouseHeader.style.display="none";var mouseSensitivityBox=document.getElementById("mouseSensitivityBox");mouseSensitivityBox.style.display="none";var mouseSensitivitySlider=document.getElementById("mouseSensitivitySlider"),scrollSensitivityBox=document.getElementById("scrollSensitivityBox");scrollSensitivityBox.style.display="none";var scrollSensitivitySlider=document.getElementById("scrollSensitivitySlider"),scrollDirectionFlipBox=document.getElementById("scrollDirectionFlipBox");scrollDirectionFlipBox.style.display="none";var scrollDirectionFlipSwitch=document.getElementById("scrollDirectionFlipSwitch"),airGesturesHeader=document.getElementById("airgestures");airGesturesHeader.style.display="none";var airMouseBox=document.getElementById("airMouseBox");airMouseBox.style.display="none";var airMouseSwitch=document.getElementById("airMouseSwitch"),mediaControlBox=document.getElementById("mediaControlBox");mediaControlBox.style.display="none";var mediaControlSwitch=document.getElementById("mediaControlSwitch"),smartTVControlBox=document.getElementById("smartTVControlBox");smartTVControlBox.style.display="none";var smartTVControlSwitch=document.getElementById("smartTVControlSwitch"),developmentHeader=document.getElementById("development");developmentHeader.style.display="none";var developerModeBox=document.getElementById("developerModeBox");developerModeBox.style.display="none";var savedDevice,savedServer,savedSettingsCharacteristic,developerModeSwitch=document.getElementById("developerModeSwitch"),leftHandedDialog=document.getElementById("leftHandedDialog"),rightHandedDialog=document.getElementById("rightHandedDialog"),vibrationsOffDialog=document.getElementById("vibrationsOffDialog"),standbyOnDialog=document.getElementById("standbyOnDialog"),mouseOnlyDialog=document.getElementById("mouseOnlyDialog"),keyboardOnlyDialog=document.getElementById("keyboardOnlyDialog"),developerModeDialog=document.getElementById("developerModeDialog"),developerModeChangedDialog=document.getElementById("developerModeChangedDialog"),searchBtn=document.getElementById("searchDevicesBtn");searchBtn.addEventListener("click",(function(){notFoundTxt.style.display="none";let e=[];e.push({services:[TAP_SERVICE]});let t=[];t.push(BATTERY_SERVICE,DEVICE_INFORMATION);let o={};o.filters=e,o.optionalServices=t,console.log("Requesting TAP device..."),navigator.bluetooth.requestDevice(o).then((e=>(deviceName=e.name,savedDevice=e,e))).then((e=>(console.log("Here we are connecting to "+e.name),e.addEventListener("gattserverdisconnected",(function(){console.log("disconnected"),disconnected()})),e.gatt.connect()))).then((e=>(savedServer=e,e.getPrimaryService(DEVICE_INFORMATION)))).then((e=>e.getCharacteristic(FIRMWARE_REVISION_STRING))).then((e=>e.readValue())).then((e=>{let t=new TextDecoder("utf-8").decode(e);return firmwareVer=semVerToInt(t),savedServer})).then((e=>e.getPrimaryService(DEVICE_INFORMATION))).then((e=>e.getCharacteristic(HARDWARE_REVISION_STRING))).then((e=>e.readValue())).then((e=>{var t=new TextDecoder("utf-8");decoded=t.decode(e);var o=decoded;return hardwareVer=semVerToInt(o),supportsAirMouse=hardwareVer>=30300&&firmwareVer>=2e4,savedServer})).then((e=>e.getPrimaryService(TAP_SERVICE))).then((e=>e.getCharacteristic(SETTINGS))).then((e=>(savedSettingsCharacteristic=e,e.readValue()))).then((e=>{let t=e.getUint8(0);var o=new BitArray.shredWithSize(t,8);leftHanded=o[0]===BitArray._ON;var n=o[1]===BitArray._ON;vibration=!n,mouseOnly=o[2]===BitArray._ON,voiceOver=o[3]===BitArray._ON,autoCorrection=o[4]===BitArray._ON,scrollDirectionFlip=o[5]===BitArray._ON,keyboardOnly=o[6]===BitArray._ON,standbyModeEnabled=o[7]===BitArray._ON;let i=e.getUint8(1),l=new BitArray.shredWithSize(i,8);mouseSensitivity=0;for(var a=1,d=0;d<4;d++)mouseSensitivity+=l[d]*a,a*=2;scrollSensitivity=0,a=1;for(d=4;d<8;d++)scrollSensitivity+=l[d]*a,a*=2;let s=e.getUint8(2),r=new BitArray.shredWithSize(s,8);doubleTapTimeout=0,a=1;for(d=0;d<4;d++)doubleTapTimeout+=r[d]*a,a*=2;var c=r[4]===BitArray._ON;airMouse=!c;var y=r[5]===BitArray._ON;airMouseMedia=!y;var u=r[6]===BitArray._ON;airMouseTv=!u;let m=e.getUint8(3),p=new BitArray.shredWithSize(m,8);sleepAfterValue=0,a=1;for(d=0;d<6;d++)sleepAfterValue+=p[d]*a,a*=2;return developerMode=p[6]===BitArray._ON,title.innerHTML="Tap Strap connected",searchBtn.style.display="none",tapName.style.display="block",tapName.innerHTML=deviceName,generalHeader.style.display="block",leftHandBox.style.display="block",leftHandedSwitch.checked=leftHanded,vibrationBox.style.display="block",vibrationSwitch.checked=vibration,standbyBox.style.display="block",standbySwitch.checked=standbyModeEnabled,doubleTapTimeoutBox.style.display="block",doubleTapTimeoutSlider.value=doubleTapTimeout,sleepAfterBox.style.display="block",sleepSelector.value=sleepAfterValue,textHeader.style.display="block",autoCorrectionBox.style.display="block",autoCorrectionSwitch.checked=autoCorrection,inputHeader.style.display="block",mouseOnlyBox.style.display="block",mouseOnlySwitch.checked=mouseOnly,keyboardOnlyBox.style.display="block",keyboardOnlySwitch.checked=keyboardOnly,mouseAndKeyboardBox.style.display="block",mouseAndKeyboard=!(mouseOnly||keyboardOnly),mouseAndKeyboardSwitch.checked=mouseAndKeyboard,mouseHeader.style.display="block",mouseSensitivityBox.style.display="block",mouseSensitivitySlider.value=mouseSensitivity,scrollSensitivityBox.style.display="block",scrollSensitivitySlider.value=scrollSensitivity,scrollDirectionFlipBox.style.display="block",scrollDirectionFlipSwitch.checked=scrollDirectionFlip,supportsAirMouse&&(airGesturesHeader.style.display="block",airMouseBox.style.display="block",airMouseSwitch.checked=airMouse,mediaControlBox.style.display="block",mediaControlSwitch.checked=airMouseMedia,smartTVControlBox.style.display="block",smartTVControlSwitch.checked=airMouseTv),developmentHeader.style.display="block",developerModeBox.style.display="block",developerModeSwitch.checked=developerMode,console.log("> Go to waiting loop"),e})).then((e=>{leftHandedSwitch.oninput=function(){(leftHanded=this.checked)?(leftHandedDialog.showModal(),leftHandedDialog.addEventListener("close",(function(){"cancel"==leftHandedDialog.returnValue?(leftHandedSwitch.checked=!1,leftHanded=!1):saveSettings()}))):(rightHandedDialog.showModal(),rightHandedDialog.addEventListener("close",(function(){"cancel"==rightHandedDialog.returnValue?(leftHandedSwitch.checked=!0,leftHanded=!0):saveSettings()})))},vibrationSwitch.oninput=function(){(vibration=this.checked)?saveSettings():(vibrationsOffDialog.showModal(),vibrationsOffDialog.addEventListener("close",(function(){"cancel"==vibrationsOffDialog.returnValue?(vibrationSwitch.checked=!0,vibration=!0):saveSettings()})))},standbySwitch.oninput=function(){standbyEnabled=this.checked,standbyEnabled?(standbyOnDialog.showModal(),standbyOnDialog.addEventListener("close",(function(){"cancel"==standbyOnDialog.returnValue?(standbySwitch.checked=!1,standbyEnabled=!1):saveSettings()}))):saveSettings()},doubleTapTimeoutSlider.oninput=function(){doubleTapTimeout=parseInt(this.value,10),saveSettings()},sleepSelector.oninput=function(){sleepAfterValue=parseInt(this.value,10),saveSettings()},autoCorrectionSwitch.oninput=function(){autoCorrection=this.checked,saveSettings()},mouseOnlySwitch.oninput=function(){(mouseOnly=this.checked)?(mouseOnlyDialog.showModal(),mouseOnlyDialog.addEventListener("close",(function(){"cancel"==mouseOnlyDialog.returnValue?(mouseOnlySwitch.checked=!1,mouseOnly=!1):(keyboardOnlySwitch.checked=!1,keyboardOnly=!1),mouseAndKeyboard=!(mouseOnly||keyboardOnly),mouseAndKeyboardSwitch.checked=mouseAndKeyboard,saveSettings()}))):(mouseAndKeyboard=!(mouseOnly||keyboardOnly),mouseAndKeyboardSwitch.checked=mouseAndKeyboard,saveSettings())},keyboardOnlySwitch.oninput=function(){(keyboardOnly=this.checked)?(keyboardOnlyDialog.showModal(),keyboardOnlyDialog.addEventListener("close",(function(){"cancel"==keyboardOnlyDialog.returnValue?(keyboardOnlySwitch.checked=!1,keyboardOnly=!1):(mouseOnlySwitch.checked=!1,mouseOnly=!1),mouseAndKeyboard=!(mouseOnly||keyboardOnly),mouseAndKeyboardSwitch.checked=mouseAndKeyboard,saveSettings()}))):(mouseAndKeyboard=!(mouseOnly||keyboardOnly),mouseAndKeyboardSwitch.checked=mouseAndKeyboard,saveSettings())},mouseAndKeyboardSwitch.oninput=function(){(mouseAndKeyboard=this.checked)?(keyboardOnlySwitch.checked=!1,keyboardOnly=!1,mouseOnlySwitch.checked=!1,mouseOnly=!1,saveSettings()):(mouseOnlySwitch.checked=!0,saveSettings())},mouseSensitivitySlider.oninput=function(){mouseSensitivity=parseInt(this.value,10),saveSettings()},scrollSensitivitySlider.oninput=function(){scrollSensitivity=parseInt(this.value,10),saveSettings()},scrollDirectionFlipSwitch.oninput=function(){scrollDirectionFlip=this.checked,saveSettings()},airMouseSwitch.oninput=function(){airMouse=this.checked,saveSettings()},mediaControlSwitch.oninput=function(){airMouseMedia=this.checked,saveSettings()},smartTVControlSwitch.oninput=function(){airMouseTv=this.checked,saveSettings()},developerModeSwitch.oninput=function(){(developerMode=this.checked)?(developerModeDialog.showModal(),developerModeDialog.addEventListener("close",(function(){"cancel"==developerModeDialog.returnValue?(developerModeSwitch.checked=!1,developerMode=!1):developerModeChangedDialog.showModal(),saveSettings()}))):(developerModeChangedDialog.showModal(),saveSettings())}})).catch((e=>{disconnected(),console.log("Argh! "+e.message),console.log("it is all over now")}))}));